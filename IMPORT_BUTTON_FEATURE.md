# 账号列表导入按钮功能说明

## 功能概述

在自动注册的账号列表中，为每个已注册的账号添加了"导入到账号池"按钮，点击后会：
1. 自动登录获取 AWS Builder ID 的 token 信息
2. 自动将账号导入到主账号池

## 实现细节

### 后端实现

**新增命令**：`auto_register_get_credentials_and_import`

**功能流程**：
1. 检查账号状态（必须是已注册状态）
2. 使用 `perform_kiro_login` 自动登录获取凭证：
   - 启动浏览器自动化
   - 输入邮箱和密码
   - 自动获取验证码（如需要）
   - 完成 AWS SSO 授权
   - 获取 Client ID、Client Secret、Refresh Token 等
3. 更新自动注册数据库中的凭证信息
4. 使用 `IdcProvider` 刷新 token 验证凭证有效性
5. 使用 `CodeWhispererClient` 获取 usage 数据
6. 将账号添加到主账号池（如已存在则更新）
7. 保存到主账号数据库

**文件修改**：
- `src-tauri/src/commands/auto_register_cmd.rs` - 添加新命令
- `src-tauri/src/lib.rs` - 注册命令

### 前端实现

**UI 变化**：
- 在账号列表的操作列中，为状态为"已注册"的账号显示绿色的导入按钮
- 按钮图标：Upload（上传图标）
- 按钮提示：导入到账号池

**交互流程**：
1. 用户点击导入按钮
2. 弹出确认对话框："确定要获取此账号的凭证并导入到主账号池吗？这将自动登录并获取 token 信息。"
3. 用户确认后，按钮显示加载动画
4. 后台自动完成登录和导入
5. 完成后显示结果消息
6. 刷新账号列表

**文件修改**：
- `src/api/autoRegister.ts` - 添加 `getCredentialsAndImport` API 函数
- `src/components/AutoRegister/AccountsTable.tsx` - 添加导入按钮和处理函数

## 使用方法

1. 在自动注册页面完成账号注册
2. 注册成功后，账号状态变为"已注册"
3. 在账号列表的操作列中，点击绿色的"导入到账号池"按钮
4. 确认操作
5. 等待自动登录和导入完成（可能需要 1-2 分钟）
6. 完成后，可以在主账号管理页面看到导入的账号

## 按钮显示条件

- ✅ 账号状态为"已注册"（registered）
- ✅ 账号有 Kiro 密码
- ❌ 账号状态为"未注册"（显示"开始注册"按钮）
- ❌ 账号状态为"进行中"（不显示导入按钮）
- ❌ 账号状态为"异常"（不显示导入按钮）

## 与批量导入的区别

| 功能 | 单个导入按钮 | 批量导入按钮 |
|------|------------|------------|
| 位置 | 账号列表每一行 | 控制面板 |
| 操作对象 | 单个账号 | 所有已注册且有凭证的账号 |
| 获取凭证 | ✅ 自动获取 | ❌ 需要先手动获取 |
| 导入 | ✅ 自动导入 | ✅ 自动导入 |
| 适用场景 | 单个账号快速导入 | 批量处理多个账号 |

## 注意事项

1. **需要 Kiro 密码**：账号必须已完成注册并有 Kiro 密码
2. **自动登录**：会自动打开浏览器完成登录，可能需要 1-2 分钟
3. **验证码**：如需验证码，会自动从邮箱获取
4. **去重**：如果主账号池中已存在相同邮箱的 BuilderId 账号，会更新而不是重复添加
5. **状态更新**：导入成功后，自动注册数据库中的账号会保存凭证信息

## 错误处理

- 如果账号未注册，会提示"账号尚未完成注册，请先完成注册"
- 如果获取凭证失败，会显示具体错误信息
- 如果导入失败，会显示"获取凭证成功但导入失败"及原因
- 所有操作都有详细的日志输出，便于调试

## 技术优势

1. **一键操作**：无需手动获取凭证再导入，一个按钮完成所有操作
2. **自动化程度高**：全程自动化，无需人工干预
3. **用户体验好**：操作简单，反馈及时
4. **错误处理完善**：各种异常情况都有相应的提示
